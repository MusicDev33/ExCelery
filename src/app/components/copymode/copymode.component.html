<!-- Page Content  -->
<main class="container-fluid">
  <!-- Lorem ipsum is here to fill up the screen width for now...
    I wish I was better at this -->
  <section style="font-size: 8px; color: #fff;" class="noselect">
    Lorem ipsum dolor sit amet, consectetur adipiscing elit,
    sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
    Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi
    ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate
    velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident,
    sunt in culpa qui officia deserunt mollit anim id est laborum.
  </section>

  <section *ngIf="!currentWorkbooks.length">
    <h4 style="color: #333;margin-top: 2em;margin-left: 2em;">No workbooks open currently. One can be opened from the sidebar.</h4>
  </section>

  <section class="row" *ngIf="currentWorkbooks.length">
    <div class="row col-sm-5" *ngFor="let workbook of currentWorkbooks">
      <div class="col">
        <div id="encompass">
          <!-- Action Bar -->
          <article class="col">
            <div class="row" id="actionbar-container">
              <span id="actionbar">
                <span class="actionbar-item actionbar-text" [ngClass]="{'inactive': header===activeTextfield}">
                  {{ workbook.filename.split('.')[0] }}
                </span>
                <i class="fas fa-times actionbar-item actionbar-icon" (click)="closeFile(workbook.filename)"></i>
                <span class="actionbar-text"> {{ keyPairs['copy'].getKeyTypeText(workbook.filename) }}</span>
              </span>
            </div>
            <div class="row search-container">
              <input class="search-field form-control" [(ngModel)]="searchText"
              name="searchText" placeholder="Header Search" [ngClass]="{'active': header===activeTextfield}" (click)="headerSearchbarClicked()">
            </div>
          </article>

          <!-- Content -->
          <article class="col">
            <div class="content-box purple-border selectable row justify-content-center"
            *ngIf="editCount >= 1 && keyPairs['copy'].primaryFile == workbook.filename" (click)="saveFile(workbook)">
              Save
            </div>
          </article>
          <article class="col">
            <div class="content-box purple-border selectable row justify-content-center"
            *ngIf="copyToHeader.length && copyFromHeader.length && keyPairs['copy'].getWhichKeyFileIn(workbook.filename) == 1" (click)="copyColumns()">
              Copy {{ keyPairs['copy'].secondaryFile }} column {{ copyFromHeader.split(":")[1] }} to
              {{ keyPairs['copy'].primaryFile }} column {{ copyToHeader.split(":")[1] }}?
            </div>
          </article>

          <article class="scroll-container">
            <div class="scrollbox">
              <div *ngFor="let header of workbook.headers">
                <div class="col">

                  <div class="content-box white-border row"
                  *ngIf="header.toLowerCase().includes(searchText.toLowerCase())"
                  (contextmenu)="onRightClick($event, header); false">
                    <span>
                      <span (click)="setActiveText(header)" class="cb-title noselect selectable"
                      (click)="headerClicked(workbook.filename, header)"
                      [ngClass]="{'cb-title-red': rowMap.hasOwnProperty(header)}">
                        {{ header }}
                      </span>
                      <i class="fas fa-check-circle header-icon hi-selected"
                      *ngIf="isSelected(workbook.filename, header)"
                      (click)="checkMarkClicked(workbook.filename, header)"></i>
                      <i class="far fa-check-circle header-icon hi-unselected"
                      *ngIf="!isSelected(workbook.filename, header)"
                      (click)="checkMarkClicked(workbook.filename, header)"></i>

                      <i class="fas fa-not-equal header-icon hi-unselected"></i>
                      <i class="fas fa-not-equal header-icon hi-selected"></i>

                      <i class="fas fa-key header-icon"
                      [ngClass]="{
                      'hi-unselected': !keyPairs['copy'].keyExists(workbook.filename, header) &&
                                          !keyPairs['copy'].isFilenameInKey(workbook.filename),
                      'hi-selected': keyPairs['copy'].keyExists(workbook.filename, header),
                      'no-show': keyPairs['copy'].isFilenameInKey(workbook.filename) && !keyPairs['copy'].keyExists(workbook.filename, header),
                      'hidden-hicon': !keyPairs['copy'].isFilenameInKey(workbook.filename)}"
                      (click)="keyPairs['copy'].setKey(workbook.filename, header)">
                      </i>
                    </span>
                    <div *ngIf="header === columnPreviews[workbook.filename]" class="preview-container col-sm-12">
                      <div class="preview-scroller-container">
                        <div class="preview-cell-container">
                          <div *ngFor="let cell of workbook.getCellsFromHeader(header)" class="content-box white-border">
                            <span>
                              <span *ngIf="keyPairs['copy'].primaryFile == workbook.filename && rowMap.hasOwnProperty(header)">
                                <span class="col-preview-row-text" *ngIf="rowMap[header].hasOwnProperty(cell.row)">
                                  {{ rowMap[header][cell.row]['mappedRow'] }}
                                </span>
                                <span *ngIf="rowMap[header].hasOwnProperty(cell.row)"
                                  [ngClass]="{'col-preview-red-text': rowMap[header][cell.row]['newValue']!==rowMap[header][cell.row]['oldValue']}">
                                  {{ rowMap[header][cell.row]['newValue'] }}
                                  <i class="fas fa-arrow-right col-preview-icon"></i>
                                </span>
                              </span>
                              <span class="col-preview-row-text">
                                {{ cell.row }}
                              </span> {{ cell.value }}
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </article>

        </div>
      </div>
    </div>
  </section>

</main>
